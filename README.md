Отлично! Давайте разберем алгоритмическое дифференцирование (АД) прямым методом на простом примере. **Прямой метод** вычисляет производные одновременно с вычислением значения функции, продвигаясь от входных переменных к выходной.

**Суть прямого метода АД:**
1.  **Разбиваем функцию:** Представляем целевую функцию как последовательность элементарных операций (сложение, умножение, синус и т.д.) над *промежуточными переменными*.
2.  **Вычисляем значения:** Делаем "прямой проход", вычисляя значение каждой промежуточной переменной последовательно.
3.  **Вычисляем производные:** **Одновременно** с шагом 2, для *каждой* промежуточной переменной вычисляем её частные производные по всем входным переменным (или по выбранному входу). Мы делаем это, применяя правила дифференцирования (цепное правило, правило суммы, произведения и т.д.) к элементарным операциям, используя уже вычисленные производные предыдущих переменных.

**Пример:** Вычислим значение функции и её градиент (вектор частных производных) в точке `(x₀, y₀) = (1, 2)` для функции:
`f(x, y) = sin(x² + y²)`

**Шаг 1: Разобьем функцию на элементарные операции (построим вычислительный граф)**

Введем промежуточные переменные:
1.  `v₁ = x²`   (Возведение в квадрат)
2.  `v₂ = y²`   (Возведение в квадрат)
3.  `v₃ = v₁ + v₂` (Сложение)
4.  `v₄ = sin(v₃)` (Синус)
5.  `f = v₄`      (Выходная функция)

**Шаг 2: Прямой проход (вычисление значений)**
Вычислим значения промежуточных переменных для `x₀ = 1`, `y₀ = 2`:
1.  `v₁ = x² = 1² = 1`
2.  `v₂ = y² = 2² = 4`
3.  `v₃ = v₁ + v₂ = 1 + 4 = 5`
4.  `v₄ = sin(v₃) = sin(5) ≈ sin(286.48°) ≈ -0.9589` (Значение синуса берем из калькулятора)
5.  `f = v₄ ≈ -0.9589`

**Шаг 3: Прямой проход (вычисление производных - суть метода АД)**
Теперь **параллельно** с вычислением значений будем вычислять частные производные каждой промежуточной переменной `vᵢ` по входным переменным `x` и `y`. Обозначим эти производные как `∂vᵢ/∂x` и `∂vᵢ/∂y`.

*   **Для `v₁ = x²`:**
    *   Значение: `v₁ = 1`
    *   Производные (правило степенной функции):
        *   `∂v₁/∂x = 2 * x = 2 * 1 = 2`
        *   `∂v₁/∂y = 0` (так как `v₁` не зависит от `y`)

*   **Для `v₂ = y²`:**
    *   Значение: `v₂ = 4`
    *   Производные:
        *   `∂v₂/∂x = 0` (так как `v₂` не зависит от `x`)
        *   `∂v₂/∂y = 2 * y = 2 * 2 = 4`

*   **Для `v₃ = v₁ + v₂`:**
    *   Значение: `v₃ = 5`
    *   Производные (правило суммы):
        *   `∂v₃/∂x = ∂(v₁ + v₂)/∂x = ∂v₁/∂x + ∂v₂/∂x = 2 + 0 = 2`
        *   `∂v₃/∂y = ∂(v₁ + v₂)/∂y = ∂v₁/∂y + ∂v₂/∂y = 0 + 4 = 4`

*   **Для `v₄ = sin(v₃)`:**
    *   Значение: `v₄ = sin(5) ≈ -0.9589`
    *   Производные (цепное правило: производная внешней функции `sin(u)` - это `cos(u)`, умноженная на производную внутренней `u`):
        *   `∂v₄/∂x = cos(v₃) * ∂v₃/∂x ≈ cos(5) * 2 ≈ (0.2837) * 2 ≈ 0.5674`
        *   `∂v₄/∂y = cos(v₃) * ∂v₃/∂y ≈ cos(5) * 4 ≈ (0.2837) * 4 ≈ 1.1348`

*   **Для `f = v₄`:**
    *   Значение: `f ≈ -0.9589`
    *   Производные (так как `f` тождественно равно `v₄`):
        *   `∂f/∂x = ∂v₄/∂x ≈ 0.5674`
        *   `∂f/∂y = ∂v₄/∂y ≈ 1.1348`

**Результат:**
*   Значение функции в точке `(1, 2)`: `f(1, 2) ≈ -0.9589`
*   Градиент функции в точке `(1, 2)`: `∇f = (∂f/∂x, ∂f/∂y) ≈ (0.5674, 1.1348)`

**Проверка (аналитически):**
Вычислим частные производные аналитически, чтобы убедиться в правильности метода АД:
1.  `f(x, y) = sin(x² + y²)`
2.  `∂f/∂x = cos(x² + y²) * 2x`
3.  `∂f/∂y = cos(x² + y²) * 2y`
Подставляем `x=1`, `y=2`:
*   `∂f/∂x = cos(1² + 2²) * 2*1 = cos(5) * 2 ≈ 0.2837 * 2 ≈ 0.5674`
*   `∂f/∂y = cos(1² + 2²) * 2*2 = cos(5) * 4 ≈ 0.2837 * 4 ≈ 1.1348`

Результаты совпадают!

**Ключевые моменты прямого метода АД:**
1.  **Последовательность:** Вычисления идут строго от входных переменных к выходной функции.
2.  **Локальность:** На каждом шаге (для каждой элементарной операции) мы используем только:
    *   Значения непосредственных входов этой операции (вычисленные на предыдущих шагах).
    *   Производные непосредственных входов этой операции по входным переменным (вычисленные на предыдущих шагах).
    *   Производную самой элементарной операции.
3.  **Эффективность (и недостаток):** Прямой метод эффективен, когда количество входов **меньше** количества выходов (что бывает редко). Для вычисления градиента функции `f: Rⁿ -> R` (1 выход) относительно `n` входов, прямому методу нужно `O(n)` проходов (или `O(n)` дополнительной памяти при векторном подходе), так как он вычисляет производные по *одному входу за раз*. Для функций со многими входами (`n` велико) более эффективен **обратный метод АД (режим обратного распространения)**.
4.  **Точность:** Метод дает производные с *машинной точностью*, так как использует те же арифметические операции, что и вычисление функции, в отличие от численного дифференцирования.

**Итог:** Прямой метод алгоритмического дифференцирования позволяет точно вычислять производные, разбивая сложную функцию на последовательность элементарных операций и вычисляя производные параллельно со значениями функции, двигаясь от входов к выходу, используя правила дифференцирования на каждом элементарном шаге.
